
> mongo_blog@1.0.0 test
> npm run test:setup && npm run test:run


> mongo_blog@1.0.0 test:setup
> export NODE_ENV=test && npm run mongo


> mongo_blog@1.0.0 mongo
> npm run mongo:restart && node test/db_check.js && npm run seed


> mongo_blog@1.0.0 mongo:restart
> npm run mongo:stop; npm run mongo:start


> mongo_blog@1.0.0 mongo:stop
> docker container stop mongo-sandbox

mongo-sandbox

> mongo_blog@1.0.0 mongo:start
> export DB_NAME=mongo_blog && docker run --rm -d -p 27017:27017 --name=mongo-sandbox -e MONGO_INITDB_DATABASE=$DB_NAME mongo:5

b42ff7150b31190a7046a980fe010225ccf2f6adc0adebdadade361ca083243b
WAITING FOR MONGO TO START
WAITING 1 SEC

> mongo_blog@1.0.0 seed
> node seed/seed.js

[33mSEEDING MONGODB LOCAL DB[0m
[35mUsing Test Username/Password
[0m

> mongo_blog@1.0.0 test:run
> mocha **/test.js --exit $WATCH



  Mongo Blog
    Static Files
      âœ” should serve CSS
    HTML Routes
      Unauthenticated
        GET / - index page showing all posts
          âœ” should NOT render new post and logout links (90ms)
          âœ” should render all post titles as links to post
          âœ” should render dates of posts, format: Thu, Oct 26, 2000
        GET /?tag={tag} - index page showing all posts by tag
          âœ” should render with non-existent tag
          âœ” should render only posts of tag: guides
          âœ” should NOT render new post and logout links
          âœ” should render only posts of tag: musings
          âœ” should NOT render new post and logout links
        GET /post/:slug - view post
          1) should render all posts by slug
          2) should render all post pages WITHOUT new post and logout links
          3) should render all post comments
          4) should render all post comments' author and date, format: 01/01/2000
        GET /admin - redirect route
          âœ” should redirect to login page
        GET /admin/login - login page
          âœ” should render HTML
        GET /admin/create-post - new post page
          âœ” should redirect to login page
        GET /admin/edit-post/:slug - edit post page
          âœ” should redirect to login page
      Authenticated
        GET / - index page
          âœ” should render new post and logout links
          âœ” should show edit and delete options for each post
        GET /?tag={tag} - index page showing all posts by tag
          âœ” should render new post and logout links
          âœ” should show edit and delete options for each post
        GET /post/:slug - view post
          5) should render all post pages with new post and logout links
          6) should render all post comments with remove option
        GET /admin - redirect route
          âœ” should redirect to index page
        GET /admin/login - login page
          âœ” should redirect to index page
        GET /admin/create-post - new post page
          âœ” should render create post page
        GET /admin/edit-post/:slug - edit post page
          âœ” should render edit post page for each post with pre-filled title (90ms)
          âœ” should render edit post page for each post with pre-filled body (81ms)
          âœ” should render edit post page for each post with pre-filled tags (75ms)
    API Routes
      Unauthenticated
        POST /api/login - login admin user
          âœ” should log user in with correct username/pass and redirect to / (71ms)
          âœ” should redirect user to /admin/login?error=true with INCORRECT username
          âœ” should redirect user to /admin/login?error=true with INCORRECT password (62ms)
        GET /api/logout - logout admin user
          âœ” should log user out and redirect to / (70ms)
        POST /api/post/:postId/comment - add comment to post
          âœ” should add comment to specific post
          âœ” should add comment to specific post with Anonymous author if author omitted
          âœ” should return 400 if no body is included
        DELETE /api/post/:postId/comment/:id - delete comment from post
          âœ” should redirect to login page
        POST /api/post - new post
          âœ” should redirect to login page
        PUT /api/post/:id - edit post
          âœ” should redirect to login page
        DELETE /api/post/:id - delete post
          âœ” should redirect to login page
      Authenticated
        DELETE /api/post/:postId/comment/:id - delete comment from post
          âœ” should remove comment from post
        POST /api/post - new post
          âœ” should add post
          âœ” should add tag ids to post if included
          âœ” should return 400 if title not included
          âœ” should return 400 if body not included
        PUT /api/post/:id - edit post
          âœ” should allow editing title
          âœ” should allow editing body
          âœ” should overwrite tags with new tags
          âœ” should remove all tags if tags are omitted
          âœ” should return 400 if body is omitted
          âœ” should return 400 if title is omitted
        DELETE /api/post/:id - delete post
          âœ” should delete post


  46 passing (1s)
  6 failing

  1) Mongo Blog
       HTML Routes
         Unauthenticated
           GET /post/:slug - view post
             should render all posts by slug:
     Error: expected 200 "OK", got 500 "Internal Server Error"
      at Context.<anonymous> (test/test.js:132:16)
      at process.processImmediate (node:internal/timers:471:21)
  ----
      at Test._assertStatus (node_modules/supertest/lib/test.js:252:14)
      at /Users/dominickbirge/Documents/mmc6278/assignment8/mmc6278-8-8-birge-dominick/node_modules/supertest/lib/test.js:308:13
      at Test._assertFunction (node_modules/supertest/lib/test.js:285:13)
      at Test.assert (node_modules/supertest/lib/test.js:164:23)
      at Server.localAssert (node_modules/supertest/lib/test.js:120:14)
      at Object.onceWrapper (node:events:627:28)
      at Server.emit (node:events:513:28)
      at emitCloseNT (node:net:2128:8)
      at process.processTicksAndRejections (node:internal/process/task_queues:81:21)

  2) Mongo Blog
       HTML Routes
         Unauthenticated
           GET /post/:slug - view post
             should render all post pages WITHOUT new post and logout links:
     Error: expected 200 "OK", got 500 "Internal Server Error"
      at Context.<anonymous> (test/test.js:146:16)
      at process.processImmediate (node:internal/timers:471:21)
  ----
      at Test._assertStatus (node_modules/supertest/lib/test.js:252:14)
      at /Users/dominickbirge/Documents/mmc6278/assignment8/mmc6278-8-8-birge-dominick/node_modules/supertest/lib/test.js:308:13
      at Test._assertFunction (node_modules/supertest/lib/test.js:285:13)
      at Test.assert (node_modules/supertest/lib/test.js:164:23)
      at Server.localAssert (node_modules/supertest/lib/test.js:120:14)
      at Object.onceWrapper (node:events:627:28)
      at Server.emit (node:events:513:28)
      at emitCloseNT (node:net:2128:8)
      at process.processTicksAndRejections (node:internal/process/task_queues:81:21)

  3) Mongo Blog
       HTML Routes
         Unauthenticated
           GET /post/:slug - view post
             should render all post comments:
     Error: expected 200 "OK", got 500 "Internal Server Error"
      at Context.<anonymous> (test/test.js:158:16)
      at process.processImmediate (node:internal/timers:471:21)
  ----
      at Test._assertStatus (node_modules/supertest/lib/test.js:252:14)
      at /Users/dominickbirge/Documents/mmc6278/assignment8/mmc6278-8-8-birge-dominick/node_modules/supertest/lib/test.js:308:13
      at Test._assertFunction (node_modules/supertest/lib/test.js:285:13)
      at Test.assert (node_modules/supertest/lib/test.js:164:23)
      at Server.localAssert (node_modules/supertest/lib/test.js:120:14)
      at Object.onceWrapper (node:events:627:28)
      at Server.emit (node:events:513:28)
      at emitCloseNT (node:net:2128:8)
      at process.processTicksAndRejections (node:internal/process/task_queues:81:21)

  4) Mongo Blog
       HTML Routes
         Unauthenticated
           GET /post/:slug - view post
             should render all post comments' author and date, format: 01/01/2000:
     Error: expected 200 "OK", got 500 "Internal Server Error"
      at Context.<anonymous> (test/test.js:172:16)
      at process.processImmediate (node:internal/timers:471:21)
  ----
      at Test._assertStatus (node_modules/supertest/lib/test.js:252:14)
      at /Users/dominickbirge/Documents/mmc6278/assignment8/mmc6278-8-8-birge-dominick/node_modules/supertest/lib/test.js:308:13
      at Test._assertFunction (node_modules/supertest/lib/test.js:285:13)
      at Test.assert (node_modules/supertest/lib/test.js:164:23)
      at Server.localAssert (node_modules/supertest/lib/test.js:120:14)
      at Object.onceWrapper (node:events:627:28)
      at Server.emit (node:events:513:28)
      at emitCloseNT (node:net:2128:8)
      at process.processTicksAndRejections (node:internal/process/task_queues:81:21)

  5) Mongo Blog
       HTML Routes
         Authenticated
           GET /post/:slug - view post
             should render all post pages with new post and logout links:
     Error: expected 200 "OK", got 500 "Internal Server Error"
      at Context.<anonymous> (test/test.js:312:16)
      at process.processImmediate (node:internal/timers:471:21)
  ----
      at Test._assertStatus (node_modules/supertest/lib/test.js:252:14)
      at /Users/dominickbirge/Documents/mmc6278/assignment8/mmc6278-8-8-birge-dominick/node_modules/supertest/lib/test.js:308:13
      at Test._assertFunction (node_modules/supertest/lib/test.js:285:13)
      at Test.assert (node_modules/supertest/lib/test.js:164:23)
      at Server.localAssert (node_modules/supertest/lib/test.js:120:14)
      at Object.onceWrapper (node:events:627:28)
      at Server.emit (node:events:513:28)
      at emitCloseNT (node:net:2128:8)
      at process.processTicksAndRejections (node:internal/process/task_queues:81:21)

  6) Mongo Blog
       HTML Routes
         Authenticated
           GET /post/:slug - view post
             should render all post comments with remove option:
     Error: expected 200 "OK", got 500 "Internal Server Error"
      at Context.<anonymous> (test/test.js:323:16)
      at process.processImmediate (node:internal/timers:471:21)
  ----
      at Test._assertStatus (node_modules/supertest/lib/test.js:252:14)
      at /Users/dominickbirge/Documents/mmc6278/assignment8/mmc6278-8-8-birge-dominick/node_modules/supertest/lib/test.js:308:13
      at Test._assertFunction (node_modules/supertest/lib/test.js:285:13)
      at Test.assert (node_modules/supertest/lib/test.js:164:23)
      at Server.localAssert (node_modules/supertest/lib/test.js:120:14)
      at Object.onceWrapper (node:events:627:28)
      at Server.emit (node:events:513:28)
      at emitCloseNT (node:net:2128:8)
      at process.processTicksAndRejections (node:internal/process/task_queues:81:21)



